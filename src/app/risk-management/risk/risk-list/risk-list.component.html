<mat-card>
  <div class="page-heading">
    <span class="mat-card-title"
      ><strong>Risk Register:</strong> {{ riskRegister?.name }}</span
    >
    <div>
      <button
        mat-raised-button
        type="button"
        [disabled]="!selectedOrganisationUnit"
        color="accent"
        (click)="create()"
      >
        <mat-icon>add</mat-icon>
        <span>Create</span>
      </button>
    </div>
  </div>
  <mat-card-content>
    <mat-progress-spinner
      *ngIf="showLoader"
      diameter="50"
      class="table-overlay"
      color="accent"
      mode="indeterminate"
    >
    </mat-progress-spinner>
    <div fxLayout fxLayout.xs="column" fxLayoutGap.xs="0">
      <div fxFlex="15%">
        <div class="ou-tree">
          <h3>Organisation Unit</h3>
          <tree-root
            #tree
            [(state)]="state"
            [nodes]="nodes | async"
            (activate)="onOuChange($event)"
            [options]="options"
          >
          </tree-root>
        </div>
      </div>
      <div fxFlex="85%">
        <mat-form-field appearance="outline">
          <mat-label>Filter Risks</mat-label>
          <input
            matInput
            (keyup)="filter($event.target.value)"
            placeholder="Search ..."
          />
        </mat-form-field>
        <table
          mat-table
          [dataSource]="getData()"
          matSort
          *ngIf="!!getData()"
          multiTemplateDataRows
        >
          <ng-container matColumnDef="code">
            <th mat-header-cell *matHeaderCellDef rowspan="3">Risk ID</th>
            <td mat-cell *matCellDef="let row; let i = index">
              {{ row.code }}
            </td>
          </ng-container>
          <ng-container matColumnDef="description">
            <th mat-header-cell *matHeaderCellDef rowspan="3">Description</th>
            <td mat-cell *matCellDef="let row; let i = dataIndex">
              {{ row.description }}
            </td>
          </ng-container>
          <ng-container matColumnDef="objective">
            <th mat-header-cell *matHeaderCellDef rowspan="3">Objective</th>
            <td mat-cell *matCellDef="let row; let i = dataIndex">
              {{ row.objectiveDescription }}
            </td>
          </ng-container>
          <ng-container matColumnDef="category">
            <th mat-header-cell *matHeaderCellDef rowspan="3">Category</th>
            <td mat-cell *matCellDef="let row; let i = dataIndex">
              {{ row.riskCategoryName }}
            </td>
          </ng-container>
          <ng-container matColumnDef="owner">
            <th mat-header-cell *matHeaderCellDef rowspan="3">Owner</th>
            <td mat-cell *matCellDef="let row; let i = dataIndex">
              {{ row.riskOwnerName }}
            </td>
          </ng-container>
          <ng-container matColumnDef="council">
            <th mat-header-cell *matHeaderCellDef colspan="3">Council</th>
            <td mat-cell *matCellDef="let row; let i = dataIndex"></td>
          </ng-container>

          <ng-container matColumnDef="inspector">
            <th mat-header-cell *matHeaderCellDef colspan="3">Inspector</th>
            <td mat-cell *matCellDef="let row; let i = dataIndex"></td>
          </ng-container>

          <ng-container matColumnDef="councilLikelihood">
            <th mat-header-cell *matHeaderCellDef>L</th>
            <td mat-cell *matCellDef="let row; let i = dataIndex">1</td>
          </ng-container>

          <ng-container matColumnDef="councilImpact">
            <th mat-header-cell *matHeaderCellDef>I</th>
            <td mat-cell *matCellDef="let row; let i = dataIndex">2</td>
          </ng-container>

          <ng-container matColumnDef="councilStatus">
            <th mat-header-cell *matHeaderCellDef>S</th>
            <td mat-cell *matCellDef="let row; let i = dataIndex">4</td>
          </ng-container>

          <ng-container matColumnDef="inspectorLikelihood">
            <th mat-header-cell *matHeaderCellDef>L</th>
            <td mat-cell *matCellDef="let row; let i = dataIndex">1</td>
          </ng-container>

          <ng-container matColumnDef="inspectorImpact">
            <th mat-header-cell *matHeaderCellDef>I</th>
            <td mat-cell *matCellDef="let row; let i = dataIndex">2</td>
          </ng-container>

          <ng-container matColumnDef="inspectorStatus">
            <th mat-header-cell *matHeaderCellDef>S</th>
            <td mat-cell *matCellDef="let row; let i = dataIndex">4</td>
          </ng-container>

          <ng-container matColumnDef="source">
            <th mat-header-cell *matHeaderCellDef colspan="6">Source</th>
            <td mat-cell *matCellDef="let row; let i = dataIndex"></td>
          </ng-container>

          <ng-container matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef rowspan="3">Action</th>
            <td mat-cell *matCellDef="let row; let i = dataIndex">Action</td>
          </ng-container>

          <tr
            mat-row
            *matHeaderRowDef="[
              'code',
              'description',
              'category',
              'objective',
              'owner',
              'source',
              'action'
            ]"
          ></tr>
          <tr mat-row *matHeaderRowDef="['council', 'inspector']"></tr>
          <tr
            mat-row
            *matHeaderRowDef="[
              'councilLikelihood',
              'councilImpact',
              'councilStatus',
              'inspectorLikelihood',
              'inspectorImpact',
              'inspectorStatus'
            ]"
          ></tr>
          <tr
            mat-row
            *matRowDef="
              let element;
              columns: [
                'code',
                'description',
                'category',
                'objective',
                'owner',
                'councilLikelihood',
                'councilImpact',
                'councilStatus',
                'inspectorLikelihood',
                'inspectorImpact',
                'inspectorStatus',
                'action'
              ]
            "
          ></tr>
        </table>
        <mat-paginator
          [length]="totalItems"
          [pageSize]="size"
          [pageSizeOptions]="pageSizeOptions"
          (page)="pageChange($event)"
        >
        </mat-paginator>
      </div>
    </div>
  </mat-card-content>
  <mat-card-actions>
    <button
      mat-raised-button
      color="primary"
      [routerLink]="['/risk-management/risk-register']"
    >
      <mat-icon>arrow_back</mat-icon>
      <span>Back to Risk Registers</span>
    </button>
  </mat-card-actions>
</mat-card>
